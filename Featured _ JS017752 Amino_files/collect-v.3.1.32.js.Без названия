var collect=function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},t=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)},i=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r},o=void 0,s=function e(){var t=this;r(this,e),this.set=function(e,r){var n=e,i=r;if(null===i)return!1;var o="";if(n.indexOf(".")>-1){var s=n.split(".");o=s[0],n=s[1]}"os_version"===n&&(i=""+i),o?"user"===o||"header"===o?t.envInfo[o][n]=i:"headers"===o?t.envInfo.header.headers[n]=i:t.envInfo.header.headers.custom[n]=i:t.envInfo.user.hasOwnProperty(n)?(["user_type","device_id","ip_addr_id"].indexOf(n)>-1?t.envInfo.user[n]=Number(i):["user_id","web_id","user_unique_id","ssid"].indexOf(n)>-1?t.envInfo.user[n]=String(i):["user_is_auth","user_is_login"].indexOf(n)>-1&&(t.envInfo.user[n]=Boolean(i)),"user_id"===n&&(t.envInfo.user.user_unique_id=String(i))):t.envInfo.header.hasOwnProperty(n)?t.envInfo.header[n]=i:t.envInfo.header.headers.hasOwnProperty(n)?t.envInfo.header.headers[n]=i:t.envInfo.header.headers.custom[n]=i},this.get=function(){var e={user:{},header:{headers:{custom:{}}}},r=t.envInfo,i=r.user,s=Object.keys(i),a=Array.isArray(s),u=0;for(s=a?s:s[Symbol.iterator]();;){var c;if(a){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}var d=c;i[d]!==o&&(e.user[d]=i[d])}var f=r.header,l=Object.keys(f),p=Array.isArray(l),h=0;for(l=p?l:l[Symbol.iterator]();;){var _;if(p){if(h>=l.length)break;_=l[h++]}else{if((h=l.next()).done)break;_=h.value}var v=_;f[v]!==o&&"headers"!==v&&(e.header[v]=f[v])}var g=r.header.headers,m=Object.keys(g),y=Array.isArray(m),b=0;for(m=y?m:m[Symbol.iterator]();;){var w;if(y){if(b>=m.length)break;w=m[b++]}else{if((b=m.next()).done)break;w=b.value}var k=w;"custom"!==k&&g[k]!==o&&(e.header.headers[k]=g[k])}var S=r.header.headers.custom,O=Object.keys(S);if(O.length){var E=O,q=Array.isArray(E),I=0;for(E=q?E:E[Symbol.iterator]();;){var x;if(q){if(I>=E.length)break;x=E[I++]}else{if((I=E.next()).done)break;x=I.value}var T=x;e.header.headers.custom[T]=S[T]}}return{user:e.user,header:n({},e.header,{headers:e.header.headers})}},this.envInfo={user:{user_unique_id:o,user_type:o,user_id:o,user_is_auth:o,user_is_login:o,device_id:o,web_id:o,ip_addr_id:o,ssid:o},header:{app_id:o,app_name:o,app_install_id:o,app_package:o,app_channel:o,app_version:o,os_name:o,os_version:o,device_model:o,ab_client:o,ab_version:o,traffic_type:o,utm_source:o,utm_medium:o,utm_campaign:o,client_ip:o,device_brand:o,os_api:o,access:o,language:o,region:o,app_language:o,app_region:o,creative_id:o,ad_id:o,campaign_id:o,log_type:o,rnd:o,platform:o,sdk_version:o,browser:o,browser_version:o,province:o,city:o,tz_name:o,timezone:o,tz_offset:o,resolution:o,referrer:o,referrer_host:o,headers:{utm_term:o,utm_content:o,custom:{}}}}},a=function(e){var r=document.createElement("a");return r.href=e,r},u=screen.width||0,c=screen.height||0,d=u+" x "+c,f=navigator.appVersion,l=navigator.userAgent,p=navigator.language,h=document.referrer,_=a(h).hostname,v=function(e){var r=a(e).search,n={};return(r=r.slice(1)).split("&").forEach(function(e){var r=e.split("="),t=r[0],i=r[1];n[t]=decodeURIComponent(void 0===i?"":i)}),n}(location.href),g="",m="",y="",b=""+parseFloat(f),w=void 0,k=void 0;-1!==(w=l.indexOf("Opera"))&&(y="Opera",b=l.substring(w+6),-1!==(w=l.indexOf("Version"))&&(b=l.substring(w+8))),-1!==(w=l.indexOf("Edge"))?(y="Microsoft Edge",b=l.substring(w+5)):-1!==(w=l.indexOf("MSIE"))?(y="Microsoft Internet Explorer",b=l.substring(w+5)):-1!==(w=l.indexOf("Chrome"))?(y="Chrome",b=l.substring(w+7)):-1!==(w=l.indexOf("Safari"))?(y="Safari",b=l.substring(w+7),-1!==(w=l.indexOf("Version"))&&(b=l.substring(w+8))):-1!==(w=l.indexOf("Firefox"))&&(y="Firefox",b=l.substring(w+8)),-1!==(k=b.indexOf(";"))&&(b=b.substring(0,k)),-1!==(k=b.indexOf(" "))&&(b=b.substring(0,k)),-1!==(k=b.indexOf(")"))&&(b=b.substring(0,k));for(var S=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(f)?"wap":"web",O=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],E=0;E<O.length;E++){var q=O[E];if(q.r.test(l)){g=q.s;break}}function I(e,r){var n=e.exec(r);return n&&n[1]?n[1]:""}/Windows/.test(g)&&(m=I(/Windows (.*)/,g),g="windows");switch(g){case"Mac OS X":m=I(/Mac OS X (10[\.\_\d]+)/,l),g="mac";break;case"Android":m=function(e){var r=I(/Android ([\.\_\d]+)/,e);return r||(r=I(/Android\/([\.\_\d]+)/,e)),r}(l),g="android";break;case"iOS":m=(m=/OS (\d+)_(\d+)_?(\d+)?/.exec(f))?m[1]+"."+m[2]+"."+(0|m[3]):"",g="ios"}var x={screen_size:d,browser:y,browser_version:b,platform:S,os_name:g,os_version:m,userAgent:l,screen_width:u,screen_height:c,device_model:g,language:p,referrer:h,referrer_host:_,utm_source:v.utm_source,utm_medium:v.utm_medium,utm_campaign:v.utm_campaign,utm_term:v.utm_term,utm_content:v.utm_content},T=new function e(){r(this,e),this.get=function(e){var r="";try{var n=localStorage.getItem(e);n&&(r=n=JSON.parse(n))}catch(e){console.error(e.message)}return r},this.set=function(e,r){try{localStorage.setItem(e,r)}catch(e){console.error(e)}}},C="tea-web-sdk: ",N=new function n(){var t=this;r(this,n),this.init=function(e){t.isLog=e},this.info=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if(t.isLog){var o;(o=console).log.apply(o,[C+e].concat(n))}},this.warn=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if(t.isLog){var o;(o=console).warn.apply(o,[C+e].concat(n))}},this.error=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if(t.isLog){var o;(o=console).error.apply(o,[C+e].concat(n))}},this.logJSON=function(r){"object"===(void 0===r?"undefined":e(r))&&t.isLog},this.throw=function(e){throw t.error(C),new Error(e)},this.table=function(e){t.isLog&&console.table(e)}},P=function(e,r,n,t){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json; charset=utf-8"),i.onload=function(){try{var e=JSON.parse(i.responseText);n&&n(e)}catch(e){console.error(e.message),t&&t()}},i.onerror=function(){t&&t()},i.send(JSON.stringify(r))},A="__tea_cache_",R=(new Date).getTimezoneOffset(),U=-R/60,j=60*R,D=void 0;try{D="3.1.32"}catch(e){D="2.x"}var J=new(function(e){t(n,e);function n(){r(this,n);var t=i(this,e.call(this));return t.initClientEnv=function(){t.set("os_name",x.os_name),t.set("os_version",x.os_version),t.set("device_model",x.device_model),t.set("platform",x.platform),t.set("sdk_version",D),t.set("browser",x.browser),t.set("browser_version",x.browser_version),t.set("language",x.language),t.set("timezone",U),t.set("tz_offset",j),t.set("resolution",x.screen_width+"x"+x.screen_height),t.set("screen_width",x.screen_width),t.set("screen_height",x.screen_height),t.set("referrer",x.referrer),t.set("referrer_host",x.referrer_host),t.set("utm_source",x.utm_source),t.set("utm_medium",x.utm_medium),t.set("utm_campaign",x.utm_campaign),t.set("utm_term",x.utm_term),t.set("utm_content",x.utm_content)},t.initClientEnv(),t}return n}(s)),M=new(function(){function e(){r(this,e)}return e.prototype.isString=function(e){return"String"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isNumber=function(e){return"Number"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isBoolean=function(e){return"Boolean"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isFunction=function(e){return"Function"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isNull=function(e){return"Null"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isUndefined=function(e){return"Undefined"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isObj=function(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isArray=function(e){return"Array"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isFalse=function(e){return""===e||void 0===e||null===e||"null"===e||"undefined"===e||0===e||!1===e||NaN===e},e.prototype.isTrue=function(e){return!this.isFalse(e)},e.prototype.isLowIE=function(){return window.XDomainRequest},e}()),L={va:"https://maliva-mcs.byteoversea.com",sg:"https://sgali-mcs.byteoversea.com",cn:"https://mcs.snssdk.com",internal:"https://mcs.byted.org"},W=function(e){try{var r=document.cookie.match(new RegExp("(?:^|;)\\s*"+e+"=([^;]+)"));return decodeURIComponent(r?r[1]:"")}catch(e){return""}},F=function(e){t(o,e);function o(){r(this,o);var t=i(this,e.call(this));return t.init=function(e,r){if("number"!=typeof e)throw new Error("app_id 必须是一个数字，注意检查是否是以`string`的方式传入的？");t.app_id=e,t.evtDataCacheKey=A+"events_"+e,t.initUrls(r),t.setEnv("app_id",e)},t.initUrls=function(e){if(!L[e])throw new Error("channel 变量只能是`internal`, `cn`, `sg`,`va`");t.reportUrl=L[e]+"/v1/list",t.userTokensPrefix=""+L[e]},t.setEnv=function(e,r){if("app_id"===e&&t.checkUserToken(r),"user_unique_id"===e){if(t.blackUuid.some(function(e){return e===String(r)}))return void N.warn('设置了无效的值 {user_unique_id："%s"}。该操作已忽略。',r);t.verifyTokens(r)}t.set(e,r)},t.transferFromCookie=function(){var e=t.tokensCacheKey,r=W("tt_webid"),n=W("__tea_sdk__ssid"),i=W("__tea_sdk__user_unique_id");if(M.isLowIE()){if(r){var o={web_id:r,ssid:r,user_unique_id:r};T.set(e,JSON.stringify(o))}return!1}if(r&&n&&i){var s={web_id:r,ssid:n,user_unique_id:i};T.set(e,JSON.stringify(s))}},t.purifyBlackUuid=function(e){if(t.blackUuid.some(function(r){return r===e.user_unique_id})){var r={};return T.set(t.tokensCacheKey,JSON.stringify(r)),N.warn('检测到无效的用户标识，已重置用户状态。{user_unique_id: "%s"}',e.user_unique_id),r}return e},t.getUserTokens=function(){var e=T.get(t.tokensCacheKey);return t.purifyBlackUuid(e)},t.checkUserToken=function(e){var r=A+"tokens_"+e;t.tokensCacheKey=r,t.transferFromCookie();var n=t.getUserTokens();return n.user_unique_id&&n.web_id&&n.ssid?(t.envInfo.user.user_unique_id=n.user_unique_id,t.envInfo.user.web_id=n.web_id,t.envInfo.user.ssid=n.ssid,N.warn("初始化已经检测到了 webid ssid user_id，一般情况下不需要再次验证 id 了"),t.unlock(),!1):t.requestWebId(e)},t.requestWebId=function(){t.isRequestWebId=!0;var e=t.userTokensPrefix+"/v1/user/webid";P(e,{app_id:t.app_id,url:location.href,user_agent:x.userAgent,referer:x.referrer,user_unique_id:""},function(e){var r=t.tokensCacheKey;if(0!==e.e)N.error("请求 webid 失败~");else{t.isRequestWebId=!1,t.envInfo.user.ssid=e.ssid,t.envInfo.user.web_id=e.web_id,t.envInfo.user.user_unique_id=e.web_id;var n={web_id:e.web_id,ssid:e.ssid,user_unique_id:e.web_id};T.set(r,JSON.stringify(n)),t.waitForVerifyTokens?(t.lock(),t.verifyTokens(t.realUuid)):(t.unlock(),t.callback&&t.callback())}},function(){t.isRequestWebId=!1,N.error("获取 webid 失败，数据将不会被上报")})},t.verifyTokens=function(e){var r=t.tokensCacheKey;if(t.waitForVerifyTokens=!1,t.realUuid=""+e,t.isRequestWebId)return t.waitForVerifyTokens=!0,N.warn("正在请求 webid，requestSsid 将会在前者请求完毕之后被调用"),!1;var i=T.get(r);if(i.user_unique_id===t.realUuid&&i.ssid&&i.web_id)N.warn("传入的 user_id/user_unique_id 与 缓存中的完全一致，无需再次请求"),t.unlock();else{t.lock(),t.envInfo.user.user_unique_id=t.realUuid;var o=n({},T.get(r),{user_unique_id:t.realUuid});if(T.set(r,JSON.stringify(o)),M.isLowIE())return t.unlock(),!1;t.isSsidDisabled?(t.unlock(),t.callback&&t.callback()):t.requestSsid()}},t.requestSsid=function(){var e=t.tokensCacheKey,r=T.get(e),i=t.userTokensPrefix+"/v1/user/ssid";P(i,{app_id:t.app_id,web_id:r.web_id,user_unique_id:""+r.user_unique_id},function(i){if(t.unlock(),0!==i.e)N.error("请求 ssid 失败~");else{t.envInfo.user.ssid=i.ssid;var o=n({},r,{ssid:i.ssid});T.set(e,JSON.stringify(o)),N.warn("根据 user_unique_id 更新 ssid 成功！注意：在这之前不应该有数据被发出去"),t.callback&&t.callback()}},function(){t.unlock(),N.error("根据 user_unique_id 获取新 ssid 失败")})},t.setEvtParams=function(e){var r=n({},e);Object.keys(r).forEach(function(e){t.evtParams[e]=r[e]})},t.mergeEnvToEvents=function(e){for(var r=[],i=t.evtParams;e.length;){var o={events:[],user:{},header:{},verbose:t.debugMode?1:void 0},s=e.splice(0,5);o.events=s.map(function(e){return n({},e,{params:JSON.stringify(n({},i,e.params))})});var a=t.mergeEnv();o.user=a.user,o.header=a.header,r.push(o)}return r},t.mergeEnv=function(){var e=t.get(),r=J.get(),i=n({},e.user),o=n({},r.header.headers.custom,e.header.headers.custom),s=n({},r.header.headers,e.header.headers,{custom:o}),a=n({},r.header,e.header);return{user:i,header:n({},a,{headers:JSON.stringify(s)})}},t.evtParams={},t.isSsidDisabled=!1,t.debugMode=!1,t.blackUuid=["null","undefined","0","","None"],t}return o.prototype.lock=function(){this.isUserTokensReady=!1},o.prototype.unlock=function(){this.isUserTokensReady=!0},o.prototype.disableSSID=function(e){this.isSsidDisabled=e},o.prototype.enableDebugMode=function(e){this.debugMode=e},o}(s),K=new function e(){var n=this;r(this,e),this.set=function(e,r){n.cache[e]=r},this.get=function(e){var r=[],t=n.cache[e];if(t){var i=t,o=Array.isArray(i),s=0;for(i=o?i:i[Symbol.iterator]();;){var a;if(o){if(s>=i.length)break;a=i[s++]}else{if((s=i.next()).done)break;a=s.value}var u=a;r.push(u)}}else r=[];return r},this.clean=function(e){n.cache[e]=void 0},this.cache={}},V=function(e,r){try{var n=e.split("v1")[0];r.forEach(function(e){var r=function(e){var r="";for(var n in e)e.hasOwnProperty(n)&&(r+="&"+n+"="+encodeURIComponent(JSON.stringify(e[n])));return r="&"===r[0]?r.slice(1):r}(e),t=new Image(1,1);t.onload=function(){t=null},t.onerror=function(){t=null},t.src=n+"/v1/gif?"+r})}catch(e){N.error(e.message)}},X=function(e,r){if(window.XDomainRequest)return V(e,r);var n=new XMLHttpRequest;n.open("POST",e+"?rdn="+Math.random(),!0),n.onload=function(){try{var e=JSON.parse(n.responseText);N.info("report sdk event success,",e)}catch(e){N.error(e.message)}},n.onerror=function(){n.abort()},n.send(JSON.stringify(r))},z=!1,B=function(e,r,n,t){try{var i=e.split("v1")[0];i||console.error("Reported url is wrong"),r.forEach(function(e){var r=function(e){var r="";for(var n in e)e.hasOwnProperty(n)&&(r+="&"+n+"="+encodeURIComponent(JSON.stringify(e[n])));return r="&"===r[0]?r.slice(1):r}(e),o=new Image(1,1);o.onload=function(){o=null,n()},o.onerror=function(){o=null,t()},o.src=i+"/v1/gif?"+r})}catch(e){console.error(e.message)}},H=function(e){var r=e.url,n=e.data,t=e.success,i=e.fail,o=e.notSure,s=e.isUnload;if(!z){z=!0;try{var a=n[0].header,u=n[0].user;G(r,{app_id:a.app_id,app_name:a.app_name,sdk_version:JSON.parse(a.headers).sdk_version,web_id:u.web_id})}catch(e){console.error("hasOnloadReport",e.message)}}var c=n;if(window.XDomainRequest)B(r,c,t,i);else if(s){if(window.navigator&&window.navigator.sendBeacon){o();var d=window.navigator.sendBeacon(r,JSON.stringify(c));return N.info("beacon:",d),void(d?(t(),N.info("beacon: success",d)):i())}B(r,c,t,i)}else{var f=new XMLHttpRequest;f.open("POST",r+"?rdn="+Math.random(),!0),f.onload=function(){try{var e=JSON.parse(f.responseText);0!==e.e?(Q(r,c,e.e),-2===e.e&&N.warn("The field is in the wrong format. It is most likely written as an int string"),N.error("数据上报失败！","错误码："+e.e),N.error("为了避免后续上报数据被阻塞，sdk 将不再重试上报本数据，数据实体将会从 localstorage 清除")):N.warn("数据上报成功: ",c),t()}catch(e){N.error(e.message),i(),Q(r,c,500)}},f.onerror=function(){f.abort(),N.error("数据上报失败"),i(),Q(r,c,500)},f.send(JSON.stringify(c))}},G=function(e,r){try{var n={events:[{event:"onload",params:JSON.stringify({app_id:r.app_id,app_name:r.app_name||"",sdk_version:r.sdk_version}),local_time_ms:Date.now()}],user:{user_unique_id:r.web_id},header:{app_id:1338}};setTimeout(function(){X(e,[n])},16)}catch(e){console.error("postOnloadLog: ",e.message)}},Q=function(e,r,n){re.reportErrorCallback(r,n);try{var t=r[0].user,i=r[0].header,o=[];r.forEach(function(e){e.events.forEach(function(e){o.push(e)})});var s={events:o.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:n,app_id:i.app_id,app_name:i.app_name||"",error_event:e.event,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(i),user:JSON.stringify(t)}),local_time_ms:Date.now()}}),user:{user_unique_id:t.user_unique_id},header:{app_id:1338}};setTimeout(function(){X(e,[s])},16)}catch(e){console.error("postErrLog: ",e.message)}},Y=function(e){t(n,e);function n(t){var o=t.app_id,s=t.channel,a=t.log;r(this,n);var u=i(this,e.call(this));return u.addListener=function(){window.addEventListener("unload",function(){u.report(!0)},!1),window.addEventListener("beforeunload",function(){u.report(!0)},!1),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState&&u.report(!0)},!1)},u.setReady=function(e){u.isReady=e,u.report()},u.event=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=K.get(u.evtDataCacheKey)||[],n=[].concat(r,e);K.set(u.evtDataCacheKey,n),n.length>=5?u.report():setTimeout(function(){u.report()},45)},u.report=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!u.isUserTokensReady)return!1;if(!u.isReady)return!1;var r=u.evtDataCacheKey,n=K.get(r);K.clean(r);var t=u.mergeEnvToEvents(n),i=T.get(r)||[],o=t.concat(i);if(!o.length)return N.info("内存缓存，以及 localStorage 中的剩余数据均已上报完毕，等待下次事件触发！"),N.info(""),!1;if(T.set(r,JSON.stringify(o)),u.isReporting)return!1;N.info("localStorage 中固化的数据，即将被分解上报！"),N.info(o);var s=0,a=null,c=u.sliceLength,d=o.length;d<=c?(s=d,a=o):(s=c,N.info("上述固化数据中的"+c+"条被成功上报！"),N.info(""),a=o.slice(d-c)),u.sendData(a,s,e)},u.sendData=function(e,r,n){u.isReporting=!0;var t=function(){u.isReporting=!1};H({url:u.reportUrl,data:e,success:function(){t(),u.sendDataSuccess(r)},fail:function(){t(),setTimeout(function(){u.report()},3e3)},notSure:t,isUnload:n})},u.sendDataSuccess=function(e){var r=u.evtDataCacheKey,n=T.get(r),t=n.length,i=n.slice(0,t-e);T.set(r,JSON.stringify(i)),u.report()},u.sliceLength=5,u.init(o,s),u.isReady=!1,u.addListener(),u.enableDebugMode(!!a),u}return n}(F),Z=/^event\./,$=window.TeaAnalyticsObject;$||($="collectEvent",window.TeaAnalyticsObject=$);var ee=window[$];ee||((ee=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return ee.q.push(r),ee}).q=ee.q||[],window[$]=ee);var re={reportErrorCallback:function(){}};return new(function(){function e(){var t=this;return r(this,e),this._processCache=function(){if(t.cachaCalled)return!1;!function(){var e=[].concat(ee.q),r=function(e){if(M.isFunction(t[e[0]])){var r=e[0],n=t[r],i=e.slice(1);n.apply(t,i)}else t.event.apply(t,e)};if(ee.q.push=function(e){var n=e;return n=Array.prototype.slice.call(n),r(n),ee},!e.length)return!1;t.channel&&(t.cachaCalled=!0,e.forEach(function(e){var n=e;n=Array.prototype.slice.call(n),r(n)}));var n=0;e.some(function(e,r){if("init"===e[0])return n=r,!0})&&(t.cachaCalled=!0,0===n?e.forEach(function(e){var n=e;n=Array.prototype.slice.call(n),r(n)}):e.splice(n,1).concat(e).forEach(function(e){var n=e;n=Array.prototype.slice.call(n),r(n)}))}()},this.init=function(e){if(!M.isObj(e))throw new Error("init 的参数必须是{app_id, channel}");e.log&&N.init(!0),t.channel=new Y(e),t.channel.callback=function(){t.callbackSend&&t.start()}},this.config=function(e){M.isObj(e)||N.throw("config 参数必须是 {} 的格式"),e.log&&(N.init(!0),t.channel.enableDebugMode(!0),e.log=null);var r=Object.keys(e);if(!r.length)return!1;var n=r,i=Array.isArray(n),o=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{if((o=n.next()).done)break;s=o.value}var a=s,u=e[a];switch(a){case"evtParams":t.channel.setEvtParams(u);break;case"disable_ssid":u&&(N.warn("ssid已禁用，设置user_unique_id不会请求ssid接口。"),t.channel.disableSSID(u));break;case"disable_auto_pv":u&&(N.warn("已禁止默认上报predefine_pageview事件，需手动上报。"),t.autoSendPV=!1);break;case"_staging_flag":""+u=="1"&&N.warn("根据_staging_flag设置，数据将会上报到stag 表。"),t.channel.setEvtParams({_staging_flag:Number(u)});break;case"reportErrorCallback":"function"==typeof u&&(re.reportErrorCallback=u);break;default:t.channel.setEnv(a,u)}}},this.send=function(){t.start()},this.start=function(){if(t.channel.isUserTokensReady){if(t.isSendFuncCalled)return;t.isSendFuncCalled=!0,N.warn("看到本提示，意味着用户信息已完全就绪，上报通道打开"),N.info("用户信息",JSON.stringify(t.channel.get().user,null,2)),t.channel.setReady(!0),t._processCache(),t.autoSendPV&&t.predefinePageView()}else t.callbackSend=!0},this.predefinePageView=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={title:document.title||location.pathname,url:location.href,url_path:location.pathname},i=n({},r,e);t.event("predefine_pageview",i)},this._count=function(){var e=Date.now();return++e},this.preprocessEvent=function(e,r){Z.test(e)&&(e=e.slice(6));var n=r;M.isObj(n)||(n={}),n.event_index=t._count();return{event:e,params:n,local_time_ms:+new Date}},this.event=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];t.checkInitExec();var i=r[0],o=[];M.isArray(i)?o=r:o[0]=r,o=o.map(function(e){return t.preprocessEvent.apply(t,e)}),t.channel.event(o)},this.cachaCalled=!1,this.isSendFuncCalled=!1,this.autoSendPV=!0,this._processCache(),ee.init=this.init,ee.config=this.config,ee.send=this.send,ee.start=this.start,ee.predefinePageView=this.predefinePageView,ee}return e.prototype.checkInitExec=function(){if(!this.channel)throw new Error("请先调用init方法，初始化SDK。")},e}())}();
